function drawMap(mapWrapper,colorScale,colorVar,mapTitle,width,height,margin){var mapScale=width+margin.left+margin.right>450?5500:4500,mapMove=width+margin.left+margin.right>450?50:40,projection=d3.geo.mercator().center(d3.geo.centroid(gemeentesGeo)).scale(mapScale).translate([width/2+mapMove,height/2-30]),path=d3.geo.path().projection(projection);mapWrapper.selectAll("path").data(gemeentesGeo.features).enter().append("path").attr("d",path).attr("id",function(t){return t.properties.GM_CODE}).attr("class",function(){return"gemeente map"}).style("opacity",1).style("stroke-width",1).style("stroke","white").style("fill",function(d){var value=eval("gemeentes[GM_CODES[d.properties.GM_CODE]]."+colorVar);return"NO"===gemeentes[GM_CODES[d.properties.GM_CODE]].NVM?"#E8E8E8":0>value?"#8C8C8C":colorScale(value)}).on("mouseover",fadeIn).on("mouseout",fadeOut)}function createMapLegend(t,e,a,r,l){var n=10,o=100,s=14,p=18,i=40,c=30,m=["0%","0 - 5%","5% - 10%","> 10%","Daling in huishoudensgroei","Transformatiepotentie onbekend"];t.attr("transform","translate(20,"+(r.top+a-i-c)+")"),t.append("text").attr("transform","translate(0,0)").attr("x",0).attr("y",0).attr("dy","0.35em").attr("class","legendTitle").style("text-anchor","start").style("font-size","11px").text(l).call(wrap,200);var d=t.selectAll(".scatterLegendSquare").data(["#bdd203","#8abc0c","#61a421","#3c8a2e","#8C8C8C","#E8E8E8"]).enter().append("g").attr("class","scatterLegendSquare").attr("width",100).attr("height",s).attr("transform",function(t,e){return"translate(0,"+((e+1)*s+p)+")"});d.append("rect").attr("width",o).attr("height",s).attr("transform","translate(0,0)").style("fill","white"),d.append("rect").attr("width",n).attr("height",n).attr("transform","translate(0,0)").style("fill",function(t){return t}),d.append("text").attr("transform","translate(20,"+n/2+")").attr("class","legendText").style("text-anchor","start").attr("dy",".30em").style("font-size","9px").text(function(t,e){return m[e]})}function drawCallout(t,e,a){var r=0,l=r+190;t.append("text").attr("class","callout").attr("id","callout_title").attr("transform","translate("+r+",10)").style("font-size","12px").style("fill","#0D0D0D").text("Groningen"),t.append("text").attr("class","callout").style("fill","#6E6E6E").attr("transform","translate("+r+",35)").text(e),t.append("text").attr("class","callout").style("fill","#6E6E6E").attr("transform","translate("+r+",50)").text(a),t.append("text").attr("class","callout").attr("id","callout_top").attr("transform","translate("+(l+25)+",35)").style("text-anchor","end").text("346"),t.append("text").attr("class","callout").attr("id","callout_bottom").attr("transform","translate("+(l+25)+",50)").style("text-anchor","end").text("3467"),t.append("line").attr("class","callout line").style("stroke-width",1).style("stroke","#D1D1D1").style("shape-rendering","crispEdges").attr("x1",0).attr("x2",1.2*l).attr("y1",17).attr("y2",17)}function searchEventMapNL(t){""!=t?fadeIn(t):fadeOut()}function fadeIn(t){if("string"==typeof t)var e={GM_NAAM:t,GM_CODE:GM_NAMES[t]};else if(hasClass(d3.select(this),"cell"))var e=t;else var e=t.properties;map.selectAll("path").style("opacity",function(t){return t.properties.GM_CODE==e.GM_CODE?1:.2}),mapCallout.selectAll("#callout_title").text(e.GM_NAAM),void 0===GM_CODES[e.GM_CODE]?(mapCallout.selectAll("#callout_top").text("-"),mapCallout.selectAll("#callout_bottom").text("-")):"NO"===gemeentes[GM_CODES[e.GM_CODE]].NVM?(mapCallout.selectAll("#callout_top").text(NLformat(10*Math.round(gemeentes[GM_CODES[e.GM_CODE]].behoefte_woningen/10,0))),mapCallout.selectAll("#callout_bottom").text("-")):(mapCallout.selectAll("#callout_top").text(NLformat(10*Math.round(gemeentes[GM_CODES[e.GM_CODE]].behoefte_woningen/10,0))),mapCallout.selectAll("#callout_bottom").text(NLformat(10*Math.round(gemeentes[GM_CODES[e.GM_CODE]].kantoren_woningen/10,0)))),mapCallout.style("visibility","visible")}function fadeOut(){mapCallout.style("visibility","hidden"),map.selectAll("path").style("opacity",1)}function paletteGreen(t,e){var a=(e-t)/5;return d3.scale.threshold().range(["#bdd203","#93c201","#72b015","#589d25","#3c8a2e"]).domain([t+1*a,t+2*a,t+3*a,t+4*a])}var mapMargin={left:50,top:20,right:40,bottom:60},mapWidth=Math.min($(".dataresource.map").width(),500)-mapMargin.left-mapMargin.right,mapHeight=Math.max(550,7*mapWidth/5)-mapMargin.top-mapMargin.bottom,svgMap=d3.select(".dataresource.map").append("svg").attr("width",mapWidth+mapMargin.left+mapMargin.right).attr("height",mapHeight+mapMargin.top+mapMargin.bottom),map=svgMap.append("g").attr("class","map").attr("transform","translate("+mapMargin.left+","+mapMargin.top+")"),mapCallout=svgMap.append("g").attr("class","mapCallout").attr("transform","translate(5,"+3*mapMargin.top/4+")").style("visibility","hidden"),mapLegendWrapper=svgMap.append("g").attr("class","legend"),GM_CODES=[],allGemeentes=[],GM_NAMES=[];gemeentes.forEach(function(t,e){GM_CODES[t.GM_CODE]=e,allGemeentes[e]=t.GM_NAAM,GM_NAMES[t.GM_NAAM]=t.GM_CODE});var colorGreen=d3.scale.threshold().range(["#bdd203","#8abc0c","#61a421","#3c8a2e"]).domain([1e-4,.05,.1]);drawMap(mapWrapper=map,colorScale=colorGreen,colorVar="perc_groei_trans",mapTitle="",width=mapWidth,height=mapHeight,margin=mapMargin),createMapLegend(mapLegendWrapper,mapWidth,mapHeight,mapMargin,"Huishoudensgroei in potentie op te vangen door kantorentransformatie"),drawCallout(calloutWrapper=mapCallout,topText="Verwachte huishoudensgroei tot 2025",bottomText="Woningen door kantorentransformatie");for(var options=allGemeentes,select=document.getElementById("searchBoxMapNL"),i=0;i<options.length;i++){var opt=options[i],el=document.createElement("option");el.textContent=opt,el.value=opt,select.appendChild(el)}$(".combobox").combobox();